(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2837:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return a(7425)}])},6825:function(e,t,a){"use strict";a.d(t,{J:function(){return c},l:function(){return r}});var l=a(5893),s=a(7294),n=a(2956);function c(e){let{stats:t,showDetails:a=!1,size:c="md",className:r=""}=e,{icon:o,color:i,text:d,details:u}=(0,s.useMemo)(()=>{if(!t)return{icon:n.hKd,color:"text-neutral-500",text:"Disconnected",details:"No connection"};switch(t.connectionQuality){case"excellent":return{icon:n._0,color:"text-green-400",text:"Excellent",details:"".concat(t.latency,"ms • ").concat(t.packetLoss,"% loss")};case"good":return{icon:n._0,color:"text-green-300",text:"Good",details:"".concat(t.latency,"ms • ").concat(t.packetLoss,"% loss")};case"fair":return{icon:n.VyL,color:"text-yellow-400",text:"Fair",details:"".concat(t.latency,"ms • ").concat(t.packetLoss,"% loss")};case"poor":return{icon:n.swE,color:"text-red-400",text:"Poor",details:"".concat(t.latency,"ms • ").concat(t.packetLoss,"% loss")};default:return{icon:n.hKd,color:"text-neutral-500",text:"Disconnected",details:"No connection"}}},[t]),x={sm:{icon:"w-3 h-3",text:"text-xs",container:"gap-1"},md:{icon:"w-4 h-4",text:"text-sm",container:"gap-2"},lg:{icon:"w-5 h-5",text:"text-base",container:"gap-2"}}[c];return a?(0,l.jsxs)("div",{className:"flex flex-col ".concat(r),children:[(0,l.jsxs)("div",{className:"flex items-center ".concat(x.container),children:[(0,l.jsx)(o,{className:"".concat(x.icon," ").concat(i)}),(0,l.jsx)("span",{className:"".concat(x.text," ").concat(i," font-medium"),children:d})]}),t&&(0,l.jsx)("div",{className:"text-xs text-neutral-400 mt-1",children:u})]}):(0,l.jsxs)("div",{className:"flex items-center ".concat(x.container," ").concat(r),children:[(0,l.jsx)(o,{className:"".concat(x.icon," ").concat(i)}),a&&(0,l.jsx)("span",{className:"".concat(x.text," ").concat(i),children:d})]})}function r(e){var t;let{stats:a}=e;return a?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm text-neutral-400",children:"Connection Quality"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c,{stats:a,size:"sm"}),(0,l.jsx)("span",{className:"text-sm font-medium capitalize ".concat((e=>{switch(e){case"excellent":return"text-green-400";case"good":return"text-green-300";case"fair":return"text-yellow-400";case"poor":return"text-red-400";default:return"text-neutral-500"}})(a.connectionQuality)),children:a.connectionQuality})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Latency"}),(0,l.jsxs)("span",{className:"text-white",children:[a.latency,"ms"]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Jitter"}),(0,l.jsxs)("span",{className:"text-white",children:[a.jitter,"ms"]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Packet Loss"}),(0,l.jsxs)("span",{className:"text-white",children:[a.packetLoss,"%"]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Bitrate"}),(0,l.jsx)("span",{className:"text-white",children:(t=a.bitrate)<1e3?"".concat(t," bps"):t<1e6?"".concat((t/1e3).toFixed(1)," kbps"):"".concat((t/1e6).toFixed(1)," Mbps")})]})]})]}):(0,l.jsx)("div",{className:"text-center text-neutral-500 py-4",children:"No connection data available"})}},7425:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var l=a(5893),s=a(7294),n=a(509),c=a(117),r=a(6825),o=a(1664),i=a.n(o),d=a(2956);function u(){var e,t;let[o,u]=(0,s.useState)([]),[x,h]=(0,s.useState)([]),[m,p]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[v,j]=(0,s.useState)("LeftAlt"),[y,b]=(0,s.useState)(!1),[N,w]=(0,s.useState)(0),[S,k]=(0,s.useState)("top-right"),[C,I]=(0,s.useState)(1),[E,T]=(0,s.useState)(!0),[A,D]=(0,s.useState)(!0),[M,O]=(0,s.useState)(!0),[L,_]=(0,s.useState)(.03),[R,U]=(0,s.useState)(!0),[B,F]=(0,s.useState)(.01),P=(0,s.useRef)(null),q=(0,s.useRef)(null),J=(0,s.useRef)(null),{setVadThreshold:G}=(0,n.n)("idle","local-settings"),{setPushToTalkEnabled:z,connectionStats:K}=(0,c.M)(),[Q,V]=(0,s.useState)(!1),[X,H]=(0,s.useState)(0),W=(0,s.useRef)(null);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("hexcall-mic");e&&p(e);let t=localStorage.getItem("hexcall-speaker");t&&f(t);let a=localStorage.getItem("hexcall-ptt-key");a&&j(a);let l=localStorage.getItem("hexcall-ptt-enabled");l&&b("1"===l);let s=localStorage.getItem("hexcall-audio-ec"),n=localStorage.getItem("hexcall-audio-ns"),c=localStorage.getItem("hexcall-audio-agc"),r=localStorage.getItem("hexcall-audio-gate");null!==s&&T("0"!==s),null!==n&&D("0"!==n),null!==c&&O("0"!==c),null!==r&&_(Number(r));let o=localStorage.getItem("hexcall-auto-join");null!==o&&U("0"!==o);let i=localStorage.getItem("hexcall-vad-threshold");null!==i&&F(Number(i))}catch(e){}},[]);let Y=async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop())}catch(e){}let e=await navigator.mediaDevices.enumerateDevices();u(e.filter(e=>"audioinput"===e.kind)),h(e.filter(e=>"audiooutput"===e.kind))};function Z(){var e,t,a;J.current&&cancelAnimationFrame(J.current),J.current=null,null===(e=q.current)||void 0===e||e.disconnect(),null===(t=P.current)||void 0===t||t.close().catch(()=>{}),q.current=null,P.current=null,null===(a=W.current)||void 0===a||a.getTracks().forEach(e=>e.stop()),W.current=null}async function $(){Z();try{let e=m?{deviceId:m}:{};e.echoCancellation=E,e.noiseSuppression=A,e.autoGainControl=M,W.current=await navigator.mediaDevices.getUserMedia({audio:!Object.keys(e).length||e}),P.current=new(window.AudioContext||window.webkitAudioContext);let t=P.current.createMediaStreamSource(W.current),a=P.current.createScriptProcessor(256,1,1);a.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(0),l=0;for(let e=0;e<t.length;e++){let a=t[e];l+=a*a}let s=Math.sqrt(l/t.length);for(let e=0;e<t.length;e++)a[e]=s<L?0:t[e]},q.current=P.current.createAnalyser(),q.current.fftSize=256,t.connect(a).connect(q.current);let l=new Uint8Array(q.current.frequencyBinCount),s=()=>{if(!q.current)return;q.current.getByteTimeDomainData(l);let e=0;for(let t=0;t<l.length;t++){let a=(l[t]-128)/128;e+=a*a}let t=Math.sqrt(e/l.length);w(t),J.current=requestAnimationFrame(s)};s()}catch(e){w(0)}}(0,s.useEffect)(()=>{Y()},[]),(0,s.useEffect)(()=>($(),()=>Z()),[m,E,A,M,L]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-mic",m||"")}catch(e){}},[m]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-speaker",g||"")}catch(e){}document.querySelectorAll("audio").forEach(e=>{"setSinkId"in e&&g&&e.setSinkId(g)})},[g]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-ptt-key",v||"")}catch(e){}},[v]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-ptt-enabled",y?"1":"0")}catch(e){}},[y]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-auto-join",R?"1":"0")}catch(e){}},[R]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-audio-ec",E?"1":"0")}catch(e){}},[E]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-audio-ns",A?"1":"0")}catch(e){}},[A]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-audio-agc",M?"1":"0")}catch(e){}},[M]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-audio-gate",String(L))}catch(e){}},[L]),(0,s.useEffect)(()=>{try{localStorage.setItem("hexcall-vad-threshold",String(B))}catch(e){}},[B]),(0,s.useEffect)(()=>{try{var e,t,a,l;let s=localStorage.getItem("hexcall-overlay-corner"),n=Number(localStorage.getItem("hexcall-overlay-scale")||"1");s&&k(s),n&&I(n),null===(t=window.hexcall)||void 0===t||null===(e=t.setOverlayCorner)||void 0===e||e.call(t,s||"top-right"),null===(l=window.hexcall)||void 0===l||null===(a=l.setOverlayScale)||void 0===a||a.call(l,n||1)}catch(e){}},[]),(0,s.useEffect)(()=>{var e,t;try{localStorage.setItem("hexcall-overlay-corner",S)}catch(e){}null===(t=window.hexcall)||void 0===t||null===(e=t.setOverlayCorner)||void 0===e||e.call(t,S)},[S]),(0,s.useEffect)(()=>{var e,t;try{localStorage.setItem("hexcall-overlay-scale",String(C))}catch(e){}null===(t=window.hexcall)||void 0===t||null===(e=t.setOverlayScale)||void 0===e||e.call(t,C)},[C]);let ee="local-"+((null===(t=window.crypto)||void 0===t?void 0:null===(e=t.randomUUID)||void 0===e?void 0:e.call(t))||"user"),{connected:et,join:ea,mute:el,canJoin:es,applyConstraints:en,setVadThreshold:ec}=(0,n.n)("test-room",ee,m);(0,s.useEffect)(()=>{null==en||en({echoCancellation:E,noiseSuppression:A,autoGainControl:M})},[en,E,A,M]),(0,s.useEffect)(()=>{null==G||G(B)},[G,B]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem("hexcall-push-to-talk");if(e){let t=JSON.parse(e);b(t.enabled||!1),j(t.key||"CapsLock")}}catch(e){}},[]),(0,s.useEffect)(()=>{var e;try{localStorage.setItem("hexcall-push-to-talk",JSON.stringify({enabled:y,key:v}))}catch(e){}(null===(e=window.hexcall)||void 0===e?void 0:e.pushToTalkUpdateSettings)&&window.hexcall.pushToTalkUpdateSettings(y,v),null==z||z(y)},[y,v,z]);let er=async()=>{try{V(!0);let e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:m||void 0}}),t=new(window.AudioContext||window.webkitAudioContext),a=t.createMediaStreamSource(e),l=t.createAnalyser();l.fftSize=256,a.connect(l);let s=new Uint8Array(l.frequencyBinCount),n=()=>{if(!Q){e.getTracks().forEach(e=>e.stop()),t.close();return}l.getByteFrequencyData(s);let a=s.reduce((e,t)=>e+t,0)/s.length;H(a/255),requestAnimationFrame(n)};n()}catch(e){console.error("Audio test failed:",e),V(!1)}};async function eo(){try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator();t.type="sine",t.frequency.value=440;let a=e.createGain();a.gain.value=.1;let l=e.createMediaStreamDestination();t.connect(a).connect(l),t.start();let s=new Audio;s.setSinkId&&g&&await s.setSinkId(g),s.srcObject=l.stream,s.play(),setTimeout(()=>{t.stop(),e.close()},800)}catch(e){}}return(0,s.useEffect)(()=>{Promise.resolve().then(a.bind(a,851)).then(e=>{let{VoiceClient:t}=e,a=window.__hexcall_vc;a&&"function"==typeof a.onLevel&&(a.onLevel=e=>w(e))})},[]),(0,l.jsx)("div",{className:"min-h-screen bg-hextech",children:(0,l.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(i(),{href:"/",className:"chip rounded px-2 py-1",children:"← Back"}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-gradient",children:"Settings"})]}),(0,l.jsxs)("div",{className:"mt-6 grid md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"glass rounded-xl p-5",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("h2",{className:"text-sm text-neutral-300",children:"Audio Devices"}),(0,l.jsx)("button",{onClick:Y,className:"p-2 rounded-lg hover:bg-white/10 transition-colors text-neutral-400 hover:text-white",title:"Refresh devices",children:(0,l.jsx)(d.Rc_,{className:"w-4 h-4"})})]}),(0,l.jsx)("label",{className:"text-xs text-neutral-400",children:"Microphone"}),(0,l.jsxs)("select",{className:"mt-1 bg-neutral-900 border border-neutral-800 rounded px-3 py-2 w-full",value:m,onChange:e=>p(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"System Default"}),o.map(e=>(0,l.jsx)("option",{value:e.deviceId,children:e.label||"Mic"},e.deviceId))]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"text-xs text-neutral-400",children:"Audio Test"}),(0,l.jsx)("button",{onClick:Q?()=>{V(!1),H(0)}:er,className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat(Q?"bg-red-500 hover:bg-red-600 text-white":"bg-violet-500 hover:bg-violet-600 text-white"),children:Q?"Stop Test":"Test Mic"})]}),Q&&(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("div",{className:"flex-1 bg-neutral-800 rounded-full h-2 overflow-hidden",children:(0,l.jsx)("div",{className:"bg-green-500 h-full rounded-full transition-all",style:{width:"".concat(100*X,"%")}})}),(0,l.jsxs)("span",{className:"text-xs text-green-400 min-w-[3ch]",children:[Math.round(100*X),"%"]})]})]}),(0,l.jsx)("label",{className:"mt-4 text-xs text-neutral-400",children:"Output Device"}),(0,l.jsxs)("select",{className:"mt-1 bg-neutral-900 border border-neutral-800 rounded px-3 py-2 w-full",value:g,onChange:e=>f(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"System Default"}),x.map(e=>(0,l.jsx)("option",{value:e.deviceId,children:e.label||"Speakers"},e.deviceId))]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("div",{className:"h-2 bg-neutral-900 rounded overflow-hidden border border-neutral-800",children:(0,l.jsx)("div",{className:"h-full bg-gradient-to-r from-violet-500 to-cyan-500 transition-[width] duration-100",style:{width:"".concat(100*Math.min(1,4*N),"%")}})}),(0,l.jsx)("p",{className:"mt-1 text-xs text-neutral-400",children:"Mic input level"}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("button",{onClick:eo,className:"px-3 py-2 rounded chip",children:"Test Output"})})]})]}),(0,l.jsxs)("div",{className:"glass rounded-xl p-5",children:[(0,l.jsx)("h2",{className:"text-sm text-neutral-300 mb-3",children:"Controls"}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)("label",{className:"text-xs text-neutral-400",children:"Push-to-talk"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("input",{type:"checkbox",checked:y,onChange:e=>b(e.target.checked)}),(0,l.jsx)("input",{className:"bg-neutral-900 border border-neutral-800 rounded px-3 py-2",value:v,onChange:e=>j(e.target.value)})]}),(0,l.jsxs)("label",{className:"mt-3 flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:R,onChange:e=>U(e.target.checked)})," Auto join calls (recommended)"]})]}),(0,l.jsxs)("div",{className:"mt-5 grid gap-3",children:[(0,l.jsx)("h3",{className:"text-xs text-neutral-400",children:"Audio Improvements"}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:E,onChange:e=>T(e.target.checked)})," Echo Cancellation"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:A,onChange:e=>D(e.target.checked)})," Noise Suppression"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:M,onChange:e=>O(e.target.checked)})," Auto Gain Control"]}),(0,l.jsxs)("label",{className:"text-xs text-neutral-400",children:["Noise gate (beta) ",L.toFixed(2)]}),(0,l.jsx)("input",{type:"range",min:0,max:.2,step:.005,value:L,onChange:e=>_(Number(e.target.value))}),(0,l.jsxs)("label",{className:"text-xs text-neutral-400",children:["Voice detection threshold ",B.toFixed(3)]}),(0,l.jsx)("input",{type:"range",min:.001,max:.1,step:.001,value:B,onChange:e=>F(Number(e.target.value))}),(0,l.jsx)("p",{className:"text-xs text-neutral-500",children:"Lower = more sensitive to voice, Higher = less sensitive"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("button",{onClick:()=>ea(),disabled:!es,className:"btn-primary px-4 py-2 rounded ring-hextech disabled:opacity-50",children:et?"Connected":es?"Join Test Room":"Waiting for another user…"}),(0,l.jsx)("button",{onClick:()=>el(!0),className:"px-4 py-2 rounded chip",children:"Mute"}),(0,l.jsx)("button",{onClick:()=>el(!1),className:"px-4 py-2 rounded chip",children:"Unmute"})]})]})]}),(0,l.jsxs)("div",{className:"glass rounded-xl p-5",children:[(0,l.jsx)("h2",{className:"text-sm text-neutral-300 mb-3",children:"Connection Stats"}),(0,l.jsx)(r.l,{stats:K||null})]}),(0,l.jsxs)("div",{className:"glass rounded-xl p-5",children:[(0,l.jsx)("h2",{className:"text-sm text-neutral-300 mb-3",children:"Settings Backup"}),(0,l.jsxs)("div",{className:"grid gap-3",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify({selectedMic:m,selectedSpeaker:g,pushToTalkKey:v,usePushToTalk:y,corner:S,scale:C,echoCancellation:E,noiseSuppression:A,autoGainControl:M,vadThreshold:B,autoJoin:R,version:"1.0",exportDate:new Date().toISOString()},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="hexcall-settings-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},className:"flex-1 bg-violet-500 hover:bg-violet-600 text-white px-4 py-2 rounded transition-colors text-sm font-medium",children:"Export Settings"}),(0,l.jsxs)("label",{className:"flex-1 bg-neutral-700 hover:bg-neutral-600 text-white px-4 py-2 rounded transition-colors text-sm font-medium cursor-pointer text-center",children:["Import Settings",(0,l.jsx)("input",{type:"file",accept:".json",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let l=new FileReader;l.onload=e=>{try{var t;let a=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);a.selectedMic&&p(a.selectedMic),a.selectedSpeaker&&f(a.selectedSpeaker),a.pushToTalkKey&&j(a.pushToTalkKey),"boolean"==typeof a.usePushToTalk&&b(a.usePushToTalk),a.corner&&k(a.corner),"number"==typeof a.scale&&I(a.scale),"boolean"==typeof a.echoCancellation&&T(a.echoCancellation),"boolean"==typeof a.noiseSuppression&&D(a.noiseSuppression),"boolean"==typeof a.autoGainControl&&O(a.autoGainControl),"number"==typeof a.vadThreshold&&F(a.vadThreshold),"boolean"==typeof a.autoJoin&&U(a.autoJoin),alert("Settings imported successfully!")}catch(e){alert("Failed to import settings. Please check the file format.")}},l.readAsText(a)},className:"hidden"})]})]}),(0,l.jsx)("p",{className:"text-xs text-neutral-400",children:"Export your settings to backup or share with other devices. Import to restore previous settings."})]})]}),(0,l.jsxs)("div",{className:"glass rounded-xl p-5",children:[(0,l.jsx)("h2",{className:"text-sm text-neutral-300 mb-3",children:"Overlay"}),(0,l.jsxs)("div",{className:"grid gap-3",children:[(0,l.jsx)("label",{className:"text-xs text-neutral-400",children:"Corner"}),(0,l.jsxs)("select",{className:"bg-neutral-900 border border-neutral-800 rounded px-3 py-2 w-full",value:S,onChange:e=>k(e.target.value),children:[(0,l.jsx)("option",{value:"top-right",children:"Top Right"}),(0,l.jsx)("option",{value:"top-left",children:"Top Left"}),(0,l.jsx)("option",{value:"bottom-right",children:"Bottom Right"}),(0,l.jsx)("option",{value:"bottom-left",children:"Bottom Left"})]}),(0,l.jsxs)("label",{className:"text-xs text-neutral-400",children:["Scale (",C.toFixed(2),"x)"]}),(0,l.jsx)("input",{type:"range",min:.75,max:1.5,step:.05,value:C,onChange:e=>I(Number(e.target.value))})]})]})]})]})})}}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=2837)}),_N_E=e.O()}]);